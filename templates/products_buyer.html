{% extends "base.html" %}

{% block title %}Products - E-commerce{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1>Products</h1>
    <form method="GET" action="{{ url_for('main.search_product') }}">
        <div class="row mb-3">
            <div class="col">
                <input type="text" name="query" class="form-control" placeholder="Search" value="{{ request.args.get('query', '') }}">
            </div>
            <div class="col">
                <button type="submit" class="btn btn-primary">Search</button>
            </div>
            <div class="col">
                <button type="button" class="btn btn-secondary" id="filter-toggle">Filter</button>
            </div>
        </div>
        <div class="row mb-3" id="filter-options" style="display: none;">
            <div class="col">
                <input type="text" name="name" class="form-control" placeholder="Product Name" value="{{ request.args.get('name', '') }}">
            </div>
            <div class="col">
                <input type="text" name="description" class="form-control" placeholder="Description" value="{{ request.args.get('description', '') }}">
            </div>
            <div class="col">
                <input type="number" name="min_price" class="form-control" placeholder="Min Price" value="{{ request.args.get('min_price', '') }}">
            </div>
            <div class="col">
                <input type="number" name="max_price" class="form-control" placeholder="Max Price" value="{{ request.args.get('max_price', '') }}">
            </div>
            <div class="col">
                <select name="brand_name" class="form-control">
                    <option value="">Select Brand</option>
                    {% for brand in brands %}
                        <option value="{{ brand.name }}" {% if request.args.get('brand_name') == brand.name %}selected{% endif %}>{{ brand.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col">
                <select name="category_name" class="form-control">
                    <option value="">Select Category</option>
                    {% for category in categories %}
                        <option value="{{ category.name }}" {% if request.args.get('category_name') == category.name %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col">
                {% if request.args.get('name') %}
                    <span class="badge bg-secondary">
                        {{ request.args.get('name') }} <a href="#" class="text-white remove-filter" data-filter="name">x</a>
                    </span>
                {% endif %}
                {% if request.args.get('description') %}
                    <span class="badge bg-secondary">
                        {{ request.args.get('description') }} <a href="#" class="text-white remove-filter" data-filter="description">x</a>
                    </span>
                {% endif %}
                {% if request.args.get('min_price') %}
                    <span class="badge bg-secondary">
                        Min Price: {{ request.args.get('min_price') }} <a href="#" class="text-white remove-filter" data-filter="min_price">x</a>
                    </span>
                {% endif %}
                {% if request.args.get('max_price') %}
                    <span class="badge bg-secondary">
                        Max Price: {{ request.args.get('max_price') }} <a href="#" class="text-white remove-filter" data-filter="max_price">x</a>
                    </span>
                {% endif %}
                {% if request.args.get('brand_name') %}
                    <span class="badge bg-secondary">
                        {{ request.args.get('brand_name') }} <a href="#" class="text-white remove-filter" data-filter="brand_name">x</a>
                    </span>
                {% endif %}
                {% if request.args.get('category_name') %}
                    <span class="badge bg-secondary">
                        {{ request.args.get('category_name') }} <a href="#" class="text-white remove-filter" data-filter="category_name">x</a>
                    </span>
                {% endif %}
            </div>
        </div>
    </form>
    <div class="row">
        {% for product in products %}
            <div class="col-md-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">{{ product.name }}</h5>
                        <p class="card-text">{{ product.description }}</p>
                        <p class="card-text"><strong>Price:</strong> ${{ product.price }}</p>
                        <a href="{{ url_for('main.view_product', product_id=product.id) }}" class="btn btn-primary">View Product</a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<script>
document.getElementById('filter-toggle').addEventListener('click', function() {
    var filterOptions = document.getElementById('filter-options');
    if (filterOptions.style.display === 'none') {
        filterOptions.style.display = 'block';
    } else {
        filterOptions.style.display = 'none';
    }
});

document.querySelectorAll('.remove-filter').forEach(function(element) {
    element.addEventListener('click', function(event) {
        event.preventDefault();
        var filter = event.target.getAttribute('data-filter');
        var url = new URL(window.location.href);
        url.searchParams.delete(filter);
        window.location.href = url.toString();
    });
});
</script>
{% endblock %}